package com.radiance.ai.assistant.biz.llm.doubao.impl;

import com.radiance.ai.assistant.biz.llm.doubao.DouBaoLlmBiz;
import com.radiance.ai.assistant.core.llm.doubao.DouBaoLlm;
import org.springframework.stereotype.Service;

import javax.annotation.Resource;

/**
 * 字节跳动-豆包-LLM 业务接口实现类
 *
 * @author juncong.sh@alibaba-inc.com
 * @date 2024/9/26 10:57
 * @since 1.0.0
 */
@Service
public class DouBaoLlmBizImpl implements DouBaoLlmBiz {

    @Resource
    private DouBaoLlm douBaoLlm;

    @Override
    public String promptGenerate(String content) {
        // 推荐生成 prompt
        String systemContent = "- 你叫 Prompt 完善者，每当我给出一个词语，你会迅速将其转化为适合大模型的详细 prompt。你思维敏捷，能准确理解我的需求，用丰富的描述扩展词语的内涵，为大模型提供精准的引导。\n" +
                "- 你会以清晰、有条理的方式呈现生成的 prompt，让我能一目了然地明白如何更好地利用大模型进行创作。\n" +
                "- 输出完善后的 prompt 内容";
        return douBaoLlm.chat(systemContent, content);
    }

    @Override
    public String aiAssist(String content) {
        String asst_exam_course_name = "";
        String asst_exam_chapter_name = "";
        String dimension = "完整性";
        String first_classification = "现代建筑";
        String second_classification = "现代建筑方法";
        String core_field_recall = "创新";

        String system_prompt = "# 你是一个专业的批改作业的人工智能，需要按照以下要求执行：\n" +
                "\n" +
                "## 角色：你是一个专业的{asst_exam_course_name}课程老师 ，现在需要你批改一套{asst_exam_course_name}的{asst_exam_chapter_name}试卷，需要按照以下任务要求执行。\n" +
                "\n" +
                "## 任务\n" +
                "1. 基于给出的内容，专业和严谨的回答问题。不允许在答案中添加任何编造成分。\n" +
                "2. 对于学生回答的每道题目需要给出评分、评分原因、AI答案、学生观点AI凝练、检测是否是AI答案（给出相似度）。\n" +
                "2.1. 评分：根据评分规则评分，最高得分不能超过题目的最大分数，最低分不小于0分。评分规则是，如果是主观题，学生答案需要围绕的第一个维度: {dimension} ，其中一级指标包括: {first_classification}。二级指标包括: {second_classification}。必须包含的核心字段有：{core_field_recall}。如果是客观题，学生答案需要与参考答案进行匹配，相似度越高，参考答案中的关键名字不能写错，写错需要扣分。\n" +
                "2.2. 评分原因：每道题目的评分原因的内容不能超过300字。每个句号结束的点评的话后面需要加上溯源标记，溯源标记需要给出学生答案的溯源和参考答案的溯源，比如[S:1]，代表是学生答案的第一句话的点评，如果是连贯的溯源则需要[S:1-15],代表学生答案的第一句到第15句。；[A:1]代表参考答案的数字下标；互联网信息的来源，[I:网址链接]\"\n" +
                "2.3. 检测是否是AI答案：如果题目类型是客观题，则该选项的值为0，如果题目类型是主观题，则该选项的值为相似度百分比数值\n" +
                "2.4. 疑似AI的原因：给出学生答案疑似AI的原因，不超过300字。\n" +
                "2.5. AI答案：AI答案不超过500字，AI答案需要根据题目和评分规则给出。\n" +
                "2.6. 学生观点AI凝练：凝练学生观点不超过100字，凝练学生观点需要基于学生答案和评分规则给出。\n" +
                "3. 所有题目批改完成后需要对每道题目的得分求和，给出试卷总分。\n" +
                "\n" +
                "##【字段定义】：\n" +
                "试卷和题目请严格按照如下格式仅输出JSON，不要输出python代码，不要返回多余信息，JSON中有多个字段用顿号【、】区隔：\n" +
                "\n" +
                "### JSON字段：\n" +
                "{{\n" +
                "  \"试卷名称\": \"试卷名称\",\n" +
                "  \"题目总数\": \"题目总数\",\n" +
                "  \"总得分\": \"总得分\",\n" +
                "  \"题目列表\":[\n" +
                "    {{\n" +
                "        \"题目编号\": \"题目编号\",\n" +
                "        \"题目内容\": \"原本的题目\",\n" +
                "        \"参考答案\": \"参考答案\",\n" +
                "        \"题目总分\": \"题目总分\",\n" +
                "        \"AI评分\": \"得分\" ,\n" +
                "        \"评分原因\": \"得分原因\"\n" +
                "        \"检测是否是AI答案\": \"检测是否是AI答案\",\n" +
                "        \"疑似AI的原因\": \"学生答案疑似AI的原因\",\n" +
                "        \"AI答案\": \"AI答案\",\n" +
                "        \"学生观点的AI凝练\": \"学生观点使用AI凝练\"\n" +
                "    }}\n" +
                "    ]\n" +
                "  ...\n" +
                "}}";
            String user_upload1 = "# 需要处理的试卷内容\n" +
                    "##【试卷名称】：现代建筑设计\n" +
                    "### 试卷分值：100分\n" +
                    "### 题目1：请简述“功能主义”在现代建筑设计中的原则，并结合具体建筑实例说明其应用\n" +
                    "【题目分值】：100分\n" +
                    "【题目类型】：主观题\n" +
                    "【参考答案】：\n" +
                    "功能主义的原则：\n" +
                    "功能主义是20世纪初期兴起的一种建筑设计理念，它强调建筑的功能和实用性，认为建筑的形式应当服务于其功能。\n" +
                    "其主要原则包括：\n" +
                    "1.形式追随功能：建筑的设计应以其使用功能为导向，建筑的形状和结构应当反映其用途。\n" +
                    "2.简洁性：功能主义提倡简洁的设计，避免不必要的装饰，强调材料和结构的本质。\n" +
                    "3.灵活性：建筑设计应考虑到不同使用需求的变化，具备一定的灵活性和适应性。\n" +
                    "4.人本设计：关注使用者的需求，强调空间的舒适性和人性化。\n" +
                    "实例分析：\n" +
                    "一个经典的功能主义建筑实例是巴西利亚的国会大厦，由著名建筑师奥斯卡·尼迈耶设计。\n" +
                    "\uF0B7形式与功能：主要体现在建筑的两座主要结构——上部的圆顶和下部的矩形体，分别代表着立法和行政的功能。\n" +
                    "\uF0B7简洁性：国会大厦的外立面采用了光滑的白色混凝土，去除了传统建筑中的繁复装饰，强调了建筑的形式与功能的和谐统一。\n" +
                    "\uF0B7灵活性：国会大厦的内部空间设计灵活，可以根据不同的会议和活动需求进行调整，满足多种功能的使用。\n" +
                    "\uF0B7人本设计：建筑的设计不仅关注了功能的实现，也兼顾了使用者的体验，创造了开放、明亮的公共空间，增强了人与建筑的互动。\n" +
                    "结论：\n" +
                    "功能主义在现代建筑设计中发挥了重要作用，通过强调建筑的功能性和实用性，推动了建筑设计的简洁化和人性化。\n" +
                    "\n" +
                    "【学生答案】\n" +
                    "功能主义是现代建筑设计的核心原则之一，起源于20世纪初期，强调建筑的形式应完全服从其功能。以下是功能主义在现代建筑设计中的几个主要原则：\n" +
                    "1. **形式服从功能**：建筑的外观和结构应基于其使用目的和功能需求，而非仅仅追求装饰性。\n" +
                    "2. **简洁性**：建筑设计应追求简洁、无装饰的风格，去除一切非必要的元素。\n" +
                    "3. **经济性**：建筑设计和建造过程应注重经济效益，使用适宜的材料和技术，避免浪费。\n" +
                    "4. **通用性**：建筑应具有普遍适用性，能够满足不同人群和不同环境的需求。\n" +
                    "5. **灵活性**：建筑设计应考虑到未来的变化，建筑空间应具有可调整性和多功能性。\n" +
                    "具体建筑实例：\n" +
                    "- **范斯沃斯住宅（Farnsworth House）**：由著名建筑师路德维希·密斯·凡德罗（Ludwig Mies van der Rohe）设计，位于美国伊利诺伊州。这座住宅是功能主义的典范，其设计简洁到几乎只有一层透明的玻璃墙和一个悬浮的屋顶。整个建筑体现了“少即是多”的设计理念，形式完全服从其居住功能，没有任何多余的装饰。\n" +
                    "- **柏林新国家美术馆（Neue Nationalgalerie）**：同样由密斯·凡德罗设计，这座美术馆以其简洁的立方体形式和玻璃幕墙著称。建筑内部空间开放，没有固定的展墙，可以根据展览需要自由布置，充分体现了功能主义的灵活性和通用性。\n" +
                    "- **联合国总部大厦（United Nations Headquarters）**：由包括勒·柯布西耶（Le Corbusier）在内的国际团队设计，位于纽约。这座建筑群的功能布局非常明确，各个部分根据不同的行政、会议、办公等功能进行分区，形式简洁、功能明确。\n" +
                    "这些实例都很好地展示了功能主义在现代建筑设计中的应用，即使历经岁月，这些设计依然被认为是现代建筑中的经典之作。";
        String result = douBaoLlm.chat(system_prompt, user_upload1);

        return result;
    }
}
